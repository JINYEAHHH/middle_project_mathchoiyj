# pages/2_Game.py

import streamlit as st
import os
import random
import time
from utils import decode, display_card, CARD_DIR, load_random_cards

# â± ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "game_started" not in st.session_state:
    st.session_state.game_started = False
if "start_time" not in st.session_state:
    st.session_state.start_time = None
if "cards" not in st.session_state:
    st.session_state.cards = []

# â± ì‹œê°„ í‘œì‹œ í•¨ìˆ˜
def format_elapsed_time(start_time):
    elapsed = int(time.time() - start_time)
    hours = elapsed // 3600
    minutes = (elapsed % 3600) // 60
    seconds = elapsed % 60
    return f"{hours:02}:{minutes:02}:{seconds:02}"

# ğŸ§© í˜ì´ì§€ UI
st.set_page_config(page_title="SET ê²Œì„", layout="wide")
st.title("ğŸ® SET ë³´ë“œê²Œì„")

# â± ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ì‹œê°„ í‘œì‹œ
if st.session_state.game_started and st.session_state.start_time:
    st.markdown(
        f"<div style='position: absolute; top: 20px; right: 30px; font-size: 18px;'>"
        f"â±ï¸ {format_elapsed_time(st.session_state.start_time)}"
        f"</div>", unsafe_allow_html=True
    )

# â–¶ Start ë²„íŠ¼ ì´ë¯¸ì§€
st.markdown("### â–¶ ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.")
if st.button("ê²Œì„ ì‹œì‘í•˜ê¸°", key="start"):
    st.session_state.cards = load_random_cards()
    st.session_state.start_time = time.time()
    st.session_state.game_started = True

# ì¹´ë“œ ì¶œë ¥
if st.session_state.game_started:
    st.markdown("#### ğŸ´ í˜„ì¬ ë³´ë“œ:")
    cols = st.columns(4)
    for i, card in enumerate(st.session_state.cards):
        with cols[i % 4]:
            display_card(card)
else:
    st.image("icons/start-button.png", width=200)

